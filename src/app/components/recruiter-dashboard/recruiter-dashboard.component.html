<mat-card class="dashboard-card">
  <mat-card-header>
    <mat-card-title>My Posted Jobs</mat-card-title>
    <mat-card-subtitle *ngIf="!loading && jobs.length > 0">
      Manage your job listings and view applicants
    </mat-card-subtitle>
  </mat-card-header>


  <!-- No jobs message -->
  <mat-card-content *ngIf="jobs.length === 0" class="empty-state">
    <mat-icon class="empty-icon">work_off</mat-icon>
    <h3>No Jobs Posted</h3>
    <p>You haven't posted any job listings yet.</p>
    <!-- Optional: Add a button to create a new job -->
    <!-- <button mat-raised-button color="primary">Post a New Job</button> -->
  </mat-card-content>

  <!-- Jobs table -->
  <div class="table-container" *ngIf="!loading && jobs.length > 0">
    <table mat-table [dataSource]="jobs" class="mat-elevation-z2 jobs-table">
      <!-- Title -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let job">{{ job?.title || 'Untitled' }}</td>
      </ng-container>

      <!-- Type -->
      <ng-container matColumnDef="jobType">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let job">{{ formatJobType(job.jobType) }}</td>
      </ng-container>
      <!-- Salary -->
      <ng-container matColumnDef="salary">
        <th mat-header-cell *matHeaderCellDef>Salary</th>
        <td mat-cell *matCellDef="let job">{{ formatSalary(job?.salary) }}</td>
      </ng-container>

      <!-- Applicant Count -->
      <ng-container matColumnDef="applicantCount">
        <th mat-header-cell *matHeaderCellDef>Applicants</th>
        <td mat-cell *matCellDef="let job" class="applicant-count">
          <span class="applicant-badge" [ngClass]="{'has-applicants': job?.applicantCount > 0}">
            {{ job?.applicantCount || 0 }}
          </span>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let job">
          <!-- view applicants -->
          <button
            mat-icon-button
            color="primary"
            (click)="viewApplicants(job)"
            matTooltip="View {{ job.applicantCount }} applicants">
            <mat-icon>people</mat-icon>
          </button>

          <button
          mat-icon-button
          color="accent"
          (click)="startEdit(job)"
          matTooltip="Edit job">
          <mat-icon>edit</mat-icon>
        </button>
      
          <!-- delete job -->
          <button
            mat-icon-button
            color="warn"
            (click)="deleteJob(job)"
            matTooltip="Delete job">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</mat-card>

<div class="add-button-container">
  <button mat-flat-button color="primary" (click)="showAddForm = !showAddForm; cancelEdit()">
    {{ showAddForm ? 'Cancel' : 'Add Job' }}
  </button>
</div>


<form
  *ngIf="showAddForm"
  (ngSubmit)="editingJobId != null ? updateJob() : addJob()"
  #jobForm="ngForm"
  class="add-job-form"
>
  <!-- TITLE -->
  <mat-form-field appearance="fill">
    <mat-label>Title</mat-label>
    <!-- if editing, bind to editJob.title, else newJob.title -->
    <input
      matInput
      name="title"
      required
      *ngIf="editingJobId != null"
      [(ngModel)]="editJob.title"
    />
    <input
      matInput
      name="title"
      required
      *ngIf="editingJobId == null"
      [(ngModel)]="newJob.title"
    />
  </mat-form-field>

  <!-- DESCRIPTION -->
  <mat-form-field appearance="fill">
    <mat-label>Description</mat-label>
    <textarea
      matInput
      name="description"
      rows="3"
      required
      *ngIf="editingJobId != null"
      [(ngModel)]="editJob.description"
    ></textarea>
    <textarea
      matInput
      name="description"
      rows="3"
      required
      *ngIf="editingJobId == null"
      [(ngModel)]="newJob.description"
    ></textarea>
  </mat-form-field>

  <!-- SALARY -->
  <mat-form-field appearance="fill">
    <mat-label>Salary</mat-label>
    <input
      matInput
      type="number"
      name="salary"
      required
      *ngIf="editingJobId != null"
      [(ngModel)]="editJob.salary"
    />
    <input
      matInput
      type="number"
      name="salary"
      required
      *ngIf="editingJobId == null"
      [(ngModel)]="newJob.salary"
    />
  </mat-form-field>

  <!-- JOB TYPE -->
  <mat-form-field appearance="fill">
    <mat-label>Job Type</mat-label>
    <mat-select
      name="jobType"
      required
      *ngIf="editingJobId != null"
      [(ngModel)]="editJob.jobType"
    >
      <mat-option *ngFor="let jt of jobTypes" [value]="jt">
        {{ jt.replace('_', ' ') | titlecase }}
      </mat-option>
    </mat-select>
    <mat-select
      name="jobType"
      required
      *ngIf="editingJobId == null"
      [(ngModel)]="newJob.jobType"
    >
      <mat-option *ngFor="let jt of jobTypes" [value]="jt">
        {{ jt.replace('_', ' ') | titlecase }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <!-- DEADLINE -->
  <mat-form-field appearance="fill">
    <mat-label>Deadline</mat-label>
    <input
      matInput
      type="date"
      name="deadline"
      required
      *ngIf="editingJobId != null"
      [(ngModel)]="editJob.deadline"
    />
    <input
      matInput
      type="date"
      name="deadline"
      required
      *ngIf="editingJobId == null"
      [(ngModel)]="newJob.deadline"
    />
  </mat-form-field>

  <!-- FORM ACTIONS -->
  <div class="form-actions">
    <button mat-flat-button color="accent" type="submit" [disabled]="jobForm.invalid">
      {{ editingJobId != null ? 'Save Changes' : 'Submit' }}
    </button>
    <button *ngIf="editingJobId != null" mat-button type="button" (click)="cancelEdit()">
      Cancel
    </button>
  </div>
</form>