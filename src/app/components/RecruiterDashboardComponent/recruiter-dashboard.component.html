<mat-card class="dashboard-card">
  <mat-card-header>
    <mat-card-title>My Posted Jobs</mat-card-title>
    <mat-card-subtitle *ngIf="!loading && jobs.length > 0">
      Manage your job listings and view applicants
    </mat-card-subtitle>
  </mat-card-header>


  <!-- No jobs message -->
  <mat-card-content *ngIf="jobs.length === 0" class="empty-state">
    <mat-icon class="empty-icon">work_off</mat-icon>
    <h3>No Jobs Posted</h3>
    <p>You haven't posted any job listings yet.</p>
    <!-- Optional: Add a button to create a new job -->
    <!-- <button mat-raised-button color="primary">Post a New Job</button> -->
  </mat-card-content>

  <!-- Jobs table -->
  <div class="table-container" *ngIf="!loading && jobs.length > 0">
    <table mat-table [dataSource]="jobs" class="mat-elevation-z2 jobs-table">
      <!-- Title -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Title</th>
        <td mat-cell *matCellDef="let job">{{ job?.title || 'Untitled' }}</td>
      </ng-container>

      <!-- Type -->
      <ng-container matColumnDef="jobType">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let job">{{ formatJobType(job.jobType) }}</td>
      </ng-container>
      <!-- Salary -->
      <ng-container matColumnDef="salary">
        <th mat-header-cell *matHeaderCellDef>Salary</th>
        <td mat-cell *matCellDef="let job">{{ formatSalary(job?.salary) }}</td>
      </ng-container>

      <!-- Applicant Count -->
      <ng-container matColumnDef="applicantCount">
        <th mat-header-cell *matHeaderCellDef>Applicants</th>
        <td mat-cell *matCellDef="let job" class="applicant-count">
          <span class="applicant-badge" [ngClass]="{'has-applicants': job?.applicantCount > 0}">
            {{ job?.applicantCount || 0 }}
          </span>
        </td>
      </ng-container>

      <!-- Actions -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let job">
          <!-- view applicants -->
          <button
            mat-icon-button
            color="primary"
            (click)="viewApplicants(job)"
            matTooltip="View {{ job.applicantCount }} applicants">
            <mat-icon>people</mat-icon>
          </button>
      
          <!-- delete job -->
          <button
            mat-icon-button
            color="warn"
            (click)="deleteJob(job)"
            matTooltip="Delete job">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>
</mat-card>

<div class="add-button-container">
  <button
    mat-flat-button
    color="primary"
    (click)="showAddForm = !showAddForm">
    {{ showAddForm ? 'Cancel' : 'Add Job' }}
  </button>
</div>

<!-- Add Job Form -->
<form
  *ngIf="showAddForm"
  class="add-job-form"
  (ngSubmit)="addJob()"
  #jobForm="ngForm">

  <mat-form-field appearance="fill">
    <mat-label>Title</mat-label>
    <input
      matInput
      name="title"
      [(ngModel)]="newJob.title"
      required>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Description</mat-label>
    <textarea
      matInput
      name="description"
      [(ngModel)]="newJob.description"
      required>
    </textarea>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Salary</mat-label>
    <input
      matInput
      type="number"
      name="salary"
      [(ngModel)]="newJob.salary"
      required>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Job Type</mat-label>
    <mat-select
      name="jobType"
      [(ngModel)]="newJob.jobType"
      required>
      <mat-option *ngFor="let jt of jobTypes" [value]="jt">
        {{ jt.replace('_',' ').toLowerCase() | titlecase }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Deadline</mat-label>
    <input
      matInput
      type="date"
      name="deadline"
      [(ngModel)]="newJob.deadline"
      required>
  </mat-form-field>

  <div class="form-actions">
    <button
      mat-flat-button
      color="accent"
      type="submit"
      [disabled]="jobForm.invalid">
      Submit
    </button>
  </div>
</form>